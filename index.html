<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VAPNET - Dashboard Registrasi</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        canvas { touch-action: none; } /* Agar tanda tangan lancar di HP */
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Mengambil icon dari library Lucide
        const { 
            UserPlus, CheckCircle2, Search, Printer, Loader2, 
            Download, ChevronRight, ShieldCheck, Wifi,
            List, FileText, X, Eraser, Filter, FileSpreadsheet
        } = lucide;

        const App = () => {
            const [activeTab, setActiveTab] = React.useState('pendaftaran');
            const [currentTime, setCurrentTime] = React.useState(new Date());
            const [customerData, setCustomerData] = React.useState([]);
            const [isSubmitting, setIsSubmitting] = React.useState(false);
            const [showSuccessModal, setShowSuccessModal] = React.useState(false);
            const [showSummaryModal, setShowSummaryModal] = React.useState(false);
            const [showThermalModal, setShowThermalModal] = React.useState(false);
            const [lastRegistered, setLastRegistered] = React.useState(null);
            
            const [showFilter, setShowFilter] = React.useState(false);
            const [filters, setFilters] = React.useState({
                search: '', rt: '', rw: '', desa: '', kecamatan: '', layanan: '', paket: ''
            });

            const [signatureData, setSignatureData] = React.useState(null);
            const canvasRef = React.useRef(null);
            const isDrawing = React.useRef(false);

            const [formData, setFormData] = React.useState({
                nama: '', jalan: '', rt: '', rw: '', desa: '', kecamatan: '', kota: '',
                whatsapp: '', jenisLayanan: '', paket: ''
            });

            const daftarPaket = [
                "Paket Bronze 25 Mbps (Rp 135.000)",
                "Paket Silver 35 Mbps (Rp 165.000)",
                "Paket Gold 75 Mbps (Rp 225.000)",
                "Paket Platinum 100 Mbps (Rp 300.000)",
                "Paket promo 50 Mbps (Rp 165.000)"
            ];

            React.useEffect(() => {
                const timer = setInterval(() => setCurrentTime(new Date()), 1000);
                return () => clearInterval(timer);
            }, []);

            // Logika Tanda Tangan
            const startDrawing = (e) => {
                isDrawing.current = true;
                draw(e);
            };

            const endDrawing = () => {
                isDrawing.current = false;
                const canvas = canvasRef.current;
                if (canvas) setSignatureData(canvas.toDataURL());
            };

            const draw = (e) => {
                if (!isDrawing.current) return;
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                const rect = canvas.getBoundingClientRect();
                
                const clientX = e.clientX || (e.touches && e.touches[0].clientX);
                const clientY = e.clientY || (e.touches && e.touches[0].clientY);
                
                const x = clientX - rect.left;
                const y = clientY - rect.top;

                ctx.lineWidth = 2.5;
                ctx.lineCap = 'round';
                ctx.strokeStyle = '#0f172a';

                if (e.type === 'mousedown' || e.type === 'touchstart') {
                    ctx.beginPath();
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                    ctx.stroke();
                }
            };

            const clearSignature = () => {
                const canvas = canvasRef.current;
                if (!canvas) return;
                const ctx = canvas.getContext('2d');
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                setSignatureData(null);
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!signatureData) return;
                setIsSubmitting(true);
                
                setTimeout(() => {
                    const timestamp = new Date();
                    const newRecord = {
                        id: "VAP-" + Date.now(),
                        tanggal: new Intl.DateTimeFormat('id-ID', { dateStyle: 'long' }).format(timestamp),
                        nama: formData.nama,
                        alamat: `${formData.jalan}, RT${formData.rt}/RW${formData.rw}, ${formData.desa}, ${formData.kecamatan}`,
                        whatsapp: formData.whatsapp,
                        jenisLayanan: formData.jenisLayanan,
                        paket: formData.paket,
                        tandaTangan: signatureData,
                        status: 'Aktif'
                    };

                    setCustomerData(prev => [newRecord, ...prev]);
                    setLastRegistered(newRecord);
                    setShowSuccessModal(true);
                    setFormData({ nama: '', jalan: '', rt: '', rw: '', desa: '', kecamatan: '', kota: '', whatsapp: '', jenisLayanan: '', paket: '' });
                    clearSignature();
                    setIsSubmitting(false);
                }, 800);
            };

            return (
                <div className="flex flex-col min-h-screen bg-slate-50 text-slate-900 pb-24">
                    <header className="sticky top-0 z-30 bg-white border-b px-5 py-4 flex items-center justify-between shadow-sm">
                        <div className="flex items-center gap-2">
                            <div className="bg-blue-600 p-1.5 rounded-lg">
                                <Wifi size={18} className="text-white" />
                            </div>
                            <span className="font-black text-lg italic uppercase">VAPNET</span>
                        </div>
                        <div className="text-[10px] font-mono font-bold text-blue-500">
                            {currentTime.toLocaleTimeString('id-ID')}
                        </div>
                    </header>

                    <main className="p-4">
                        {activeTab === 'pendaftaran' ? (
                            <div className="bg-white rounded-3xl p-6 border shadow-sm space-y-5">
                                <h2 className="font-black uppercase italic tracking-tighter flex items-center gap-2">
                                    <UserPlus className="text-blue-600" size={20} /> Registrasi Baru
                                </h2>
                                <form onSubmit={handleSubmit} className="space-y-4">
                                    <input required className="w-full p-4 rounded-2xl bg-slate-50 border-2 focus:border-blue-500 outline-none text-sm font-semibold" placeholder="Nama Lengkap" value={formData.nama} onChange={(e)=>setFormData({...formData, nama: e.target.value})} />
                                    <div className="grid grid-cols-2 gap-2">
                                        <input required placeholder="RT" className="p-3 bg-slate-50 rounded-xl text-center font-bold" value={formData.rt} onChange={(e)=>setFormData({...formData, rt: e.target.value})} />
                                        <input required placeholder="RW" className="p-3 bg-slate-50 rounded-xl text-center font-bold" value={formData.rw} onChange={(e)=>setFormData({...formData, rw: e.target.value})} />
                                    </div>
                                    <input required placeholder="Desa/Kecamatan" className="w-full p-3 bg-slate-50 rounded-xl text-sm" value={formData.desa} onChange={(e)=>setFormData({...formData, desa: e.target.value})} />
                                    <select required className="w-full p-4 rounded-2xl bg-slate-50 border-2 font-bold text-sm" value={formData.paket} onChange={(e)=>setFormData({...formData, paket: e.target.value})}>
                                        <option value="">Pilih Paket...</option>
                                        {daftarPaket.map(p => <option key={p} value={p}>{p}</option>)}
                                    </select>
                                    
                                    <div className="p-4 bg-slate-900 rounded-3xl text-white space-y-2">
                                        <div className="flex justify-between items-center">
                                            <span className="text-[10px] font-bold uppercase tracking-widest">Tanda Tangan</span>
                                            <button type="button" onClick={clearSignature} className="text-[10px] text-red-400">HAPUS</button>
                                        </div>
                                        <div className="bg-white rounded-xl h-40 overflow-hidden">
                                            <canvas ref={canvasRef} width={400} height={200} className="w-full h-full" onMouseDown={startDrawing} onMouseMove={draw} onMouseUp={endDrawing} onMouseOut={endDrawing} onTouchStart={startDrawing} onTouchMove={draw} onTouchEnd={endDrawing} />
                                        </div>
                                    </div>

                                    <button type="submit" disabled={!signatureData || isSubmitting} className="w-full bg-blue-600 text-white font-black py-4 rounded-2xl shadow-lg uppercase active:scale-95 transition-all disabled:opacity-50">
                                        {isSubmitting ? "Memproses..." : "Konfirmasi Pendaftaran"}
                                    </button>
                                </form>
                            </div>
                        ) : (
                            <div className="space-y-3">
                                <h2 className="font-black uppercase italic">Data Pelanggan ({customerData.length})</h2>
                                {customerData.map(item => (
                                    <div key={item.id} className="bg-white p-4 rounded-2xl border flex justify-between items-center">
                                        <div>
                                            <div className="font-black text-sm uppercase">{item.nama}</div>
                                            <div className="text-[10px] text-blue-500 font-bold">{item.paket}</div>
                                        </div>
                                        <CheckCircle2 className="text-green-500" />
                                    </div>
                                ))}
                            </div>
                        )}
                    </main>

                    <nav className="fixed bottom-0 left-0 right-0 bg-white border-t p-4 flex justify-around rounded-t-[2rem] shadow-2xl">
                        <button onClick={() => setActiveTab('pendaftaran')} className={`flex flex-col items-center ${activeTab === 'pendaftaran' ? 'text-blue-600' : 'text-slate-400'}`}>
                            <UserPlus size={24} /> <span className="text-[8px] font-black uppercase">Daftar</span>
                        </button>
                        <button onClick={() => setActiveTab('rekap')} className={`flex flex-col items-center ${activeTab === 'rekap' ? 'text-blue-600' : 'text-slate-400'}`}>
                            <List size={24} /> <span className="text-[8px] font-black uppercase">Data</span>
                        </button>
                    </nav>

                    {showSuccessModal && (
                        <div className="fixed inset-0 bg-black/80 flex items-center justify-center p-6 z-[100]">
                            <div className="bg-white p-8 rounded-[2rem] w-full text-center">
                                <div className="bg-green-100 text-green-600 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                                    <CheckCircle2 size={40} />
                                </div>
                                <h2 className="font-black text-xl uppercase">Sukses Terdaftar!</h2>
                                <p className="text-slate-500 text-sm mb-6">Data {lastRegistered?.nama} telah disimpan.</p>
                                <button onClick={() => setShowSuccessModal(false)} className="w-full bg-slate-900 text-white py-4 rounded-2xl font-black uppercase">Tutup</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>